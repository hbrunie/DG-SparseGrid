clc
clear
close all

format short e

% Test for generating 1D matrices
Lev = 4;
Deg = 2;

%--Quadrature
quad_num=10;
%---------------

% compute the trace values
p_1 = legendre(-1,Deg);
p_2 = legendre(1,Deg);

[quad_x,quad_w]=lgwt(quad_num,-1,1);
p_val = legendre(quad_x,Deg);
Dp_val = dlegendre(quad_x,Deg);

load(['two_scale_rel_',num2str(Deg),'.mat'])
H1 = zeros(Deg);
G1 = zeros(Deg);

for j_x = 1:Deg
    for j_y = 1:Deg
        H1(j_x,j_y) = ((-1)^(j_x+j_y-2)  )*H0(j_x,j_y);
        G1(j_x,j_y) = ((-1)^(Deg+j_x+j_y-2))*G0(j_x,j_y);
    end
end

%---------------------------
% Jacobi of variable x 
% Define Matrices
%---------------------------
nx = 2^(Lev);
hx = 1/nx;
Jacobi_x = hx;
dof_1D_x = Deg*nx;


%-------------------------
% Tri-diagonal Matrix
%-------------------------
D =  Dp_val'*(quad_w.*p_val)...
    -p_1'*p_1/2+p_2'*p_2/2; % 1/hx
L = -p_1'*p_2/2; % 1/hx
U =  p_2'*p_1/2; % 1/hx

G = [G0 G1];
H = [H0 H1];

ZeroMat = zeros(Deg,Deg);

D1 = H*[D ZeroMat;ZeroMat D]*G';
L1 = H*[ZeroMat ZeroMat;L ZeroMat]*G';
U1 = H*[ZeroMat U;ZeroMat ZeroMat]*G';
Mat1 = D1+L1+U1;

D2 = G*[D ZeroMat;ZeroMat D]*H';
L2 = G*[ZeroMat ZeroMat;L ZeroMat]*H';
U2 = G*[ZeroMat U;ZeroMat ZeroMat]*H';
Mat2 = D2+L2+U2;

D3 = G*[D ZeroMat;ZeroMat D]*G';
L3 = G*[ZeroMat ZeroMat;L ZeroMat]*G';
U3 = G*[ZeroMat U;ZeroMat ZeroMat]*G';
Mat3 = D3+L3+U3;

A11 = D;%[D U;L ZeroMat]
A12 = (Mat1)*2^2;
A21 = (Mat2)*2^2;
A22 = (Mat3)*2^2;

[H0*Mat1 ZeroMat;...
    

[A11 A12;A21 A22]

for I = 1:Lev
    row = 2^(I-1)+1:2^I;
    G = blkdiag(G,G);
    H = blkdiag(H,H);
%     for J=1:Lev
%         col = 2^(J-1)+1:2^J;
%         tmp_A = 
%     end
end

figure;
subplot(1,2,1)
spy(G)
subplot(1,2,2)
spy(H)